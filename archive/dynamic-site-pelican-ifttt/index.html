<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="ClearType" content="true">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- DNS prefetch -->
        <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
        <link rel="dns-prefetch" href="//cdn.joeahand.com">

        <title>Building a Dynamic yet Static Website with Pelican & IFTTT - Joe Hand</title>
        <meta name="description" content="Better cities with local data">

        <!-- Styles -->
            <link rel="stylesheet" href="//joeahand.com/theme/main.min.css?250fcd74">

        <!-- WebFonts -->
        <script  data-cfasync="false" src="//cdnjs.cloudflare.com/ajax/libs/webfont/1.6.4/webfontloader.js"></script>
        <script data-cfasync="false" >
          WebFont.load({
            google: {
              families:  [ 'EB+Garamond::latin', 'Open+Sans:400italic,400,700,300:latin' , 'Roboto+Mono::latin' ]
            }
          });
        </script>

    </head>
    <body class="">
        <div role="document" class="document"><div class="header">
            <div class="site-header pure-menu pure-menu-horizontal pure-menu-fixed">
                <a class="pure-menu-heading small-caps" href="https://joeahand.com">Joe Hand</a><ul role="navigation" class="pure-menu-list">
        <li class="pure-menu-item ">
            <a class="pure-menu-link small" href="https://joeahand.com/about/">About Joe</a>
        </li>
        <li class="pure-menu-item ">
            <a class="pure-menu-link small" href="https://joeahand.com/cv/">CV</a>
        </li>
</ul>            </div>
        </div>
            <main role="main" class="main pure-g">
                <div class="pure-u-2-24 pure-u-lg-1-5"></div>
                <div class="page-content pure-u-20-24 pure-u-lg-3-5"><section class="post-full">
    <header>
        <h1 class="title"><a href="https://joeahand.com/archive/dynamic-site-pelican-ifttt/">Building a Dynamic yet Static Website with Pelican & IFTTT</a></h1>
        <!-- <h5 class="category small-caps"><a href="https://joeahand.com/">programming</a></h5> --></header>
    <article class="content">
      <p>Static websites seem all the rage right now, and for good reason. A static site is a website that does not have a server creating pages on every request. They are easy to host (for free), fast, and help you offload all the server's work onto the computers visiting your site (d'oh!).</p>
<p>Static websites also have some serious downsides. Foremost, the content is static - only updated when you take action. If you want <em>dynamic</em> content on the site, you have to rely on APIs and Javascript, adding to the page size and load times. In this trade off, you are passing the work on to the user rather than doing it on the server, perhaps an unwise trade off.</p>
<p>Don't panic! You can have both! If you visit my <a href="https://joeahand.com">homepage</a> you will notice dynamic content (twitters, fitbit steps, cups of joe drunk) - yet there are no API calls. How is this possible? It must be Magic! Not here, sorry.</p>
<p>The answer is Python, of course. You can <a href="https://xkcd.com/353/">fly with Python</a> and make dynamic-static websites! <em>(You can build this with other languages, but you can't fly with them... In fact, I am flying as we speak! Probably thanks to Python.)</em></p>
<h3>Quickstart (how I did it):</h3>
<ol>
<li>Set up <a href="https://ifttt.com">IFTTT</a> (If This Then That) and start sending data to Google Spreadsheets (<a href="https://ifttt.com/recipes/112226-save-your-tweets-in-a-google-spreadsheet">sample recipe</a>).</li>
<li>Grab the data with a custom <a href="http://getpelican.com">Pelican</a> <a href="https://github.com/joehand/joeahand/tree/master/plugins/pelican_gdocs">plugin</a>, process it, and output to templates.</li>
<li>Make the data pretty.</li>
<li>Create a cron job to update data &amp; regenerate site regularly (mine runs once daily).</li>
</ol>
<h2>1. IFTTT Awesomeness</h2>
<p>If you haven't checked it out, IFTTT is great. When something happens (new tweet posted) IFTTT will do something else (add a row to a spreadsheet). I started using it to automatically send emails to loved ones when I arrived at airports (via check ins on FourSquare).</p>
<p>IFTTT also has a group of apps called DO (Button, Note, Camera). These apps skip the IF and just DO something. When I have a cup of joe, I tap the DO button on my phone to record it (unfortunately, as I just found out, this doesn't work on airplanes - remind me to record this cup of coffee I drank over Idaho).</p>
<p>All of my homepage data goes through IFTTT to Google spreadsheets:</p>
<ul>
<li>Drink Coffee &gt; Tap Do Button &gt; Add to Spreadsheet</li>
<li>Joe Tweets &gt; Add to Spreadsheet</li>
<li>Pocket Article Archived &gt; Add to Spreadsheet</li>
<li>Instagram Picture Posted &gt; Add to Spreadsheet</li>
<li>Fitbit Daily Log &gt; Add to Spreadsheet</li>
</ul>
<p>Now think of the possibilities with all that data in spreadsheets! For now, let's make it into a nice dynamic-static website.</p>
<h2>2. Grabbing Spreadsheet Data w/ Pelican Plugin</h2>
<p><strong><em>Advisory:</em></strong> <em>We are going to start getting into some code here. I'm going to assume that you have a running <a href="http://getpelican.com">Pelican</a> website. If not, check out the <a href="http://docs.getpelican.com/en/3.6.2/quickstart.html">Pelican getting started</a> tutorial, it's pretty friendly.</em></p>
<p>Once the data is in Google Docs, how do we get it out? Turns out, its quite simple. Google has an option to publish spreadsheets as csv files:</p>
<div class="highlight"><pre>File &gt; Publish to Web &gt; Publish as CSV
</pre></div>


<p>Now that you have a public csv, we can grab it with the great Python <code>requests</code> library, transform it into a Python object. This will all be a part of our <a href="http://docs.getpelican.com/en/latest/plugins.html">Pelican plugin</a>. My plugin is pretty customized (for processing the data) but you can copy the guts of it.</p>
<p><strong><em>Note:</em></strong> <em>You can hop over to <a href="https://github.com/joehand/joeahand">GitHub</a> to check out the full code at any time (here is <a href="https://github.com/joehand/joeahand/tree/master/plugins/pelican_gdocs">plugin part</a>).</em></p>
<h3>Getting a Published CSV from Google</h3>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PUBLIC_CSV_URL</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</pre></div>


<p>And now you have a csv in <code>content</code>. Yes, its really that easy.</p>
<h3>Creating Python List from CSV</h3>
<p>Unfortunately, right now the <code>content</code> variable is just a big string of data, so it is not very useful. </p>
<p>Now we will create a Python list, with each item in the list being a row of the spreadsheet. Our keys will be the spreadsheet headers.</p>
<p><strong><em>Note:</em></strong> <em>This code is for Python 3. If you aren't on 3, you should really switch.</em></p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">csv</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)]</span>
<span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">header</span><span class="p">))</span>
</pre></div>


<p>Python's <code>csv</code> module makes this pretty simple. Each item in the data list is now a Python object, for example this is a row from the Instagram spreadsheet:</p>
<div class="highlight"><pre>{
    &#39;Instagram_Link&#39;:&#39;http://instagram/something&#39;, 
    &#39;Photo_URL&#39;:&#39;http://instagramcdn.com/url&#39;, 
    &#39;Caption&#39;: &#39;This is a picture&#39;, 
    &#39;Date&#39;:&#39;June 21, 2015&#39;
}
</pre></div>


<p>Captain, we have data (I'm writing this on a plane, I apologize)!</p>
<h2>3. Visualizing Data</h2>
<p>From here, what you want to do will depend on your data and how you want to show it. The plugin will allow you to access the data in your templates and then you can let your imagination run wild!</p>
<p>Using Jinja, outputting to a javascript object is fairly easy. For example, here is the data output for my Fitbit steps:</p>
<div class="highlight"><pre><span class="x">var steps_data = {</span>
<span class="x">        labels: [</span>
<span class="x">            </span><span class="cp">{%</span>- <span class="k">for</span> <span class="nv">row</span> <span class="k">in</span> <span class="nv">gdocs_data.steps</span> <span class="o">|</span> <span class="nf">reverse</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">               &#39;</span><span class="cp">{{</span><span class="nv">row.Date</span><span class="cp">}}</span><span class="x">&#39;,</span>
<span class="x">            </span><span class="cp">{%</span>- <span class="k">endfor</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">        ],</span>
<span class="x">        series: [</span>
<span class="x">            [</span>
<span class="x">            </span><span class="cp">{%</span>- <span class="k">for</span> <span class="nv">row</span> <span class="k">in</span> <span class="nv">gdocs_data.steps</span> <span class="o">|</span> <span class="nf">reverse</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">                </span><span class="cp">{{</span><span class="nv">row.TotalSteps</span><span class="cp">}}</span><span class="x">,</span>
<span class="x">            </span><span class="cp">{%</span>- <span class="k">endfor</span> -<span class="cp">%}</span><span class="x"></span>
<span class="x">            ]</span>
<span class="x">        ]</span>
<span class="x">};</span>
</pre></div>


<p>The label/series organization is how Chartist.js likes data. But you can make it whatever kind of js object you like.</p>
<p>My coffee visualization uses a table created with Jinja loops. There are probably some other options depending on what kind of data you want to visualize.</p>
<h2>4. Automatically Updating the Site</h2>
<p>One of the biggest downsides to static sites is the fact they only update when you change the content (and then usually push the site somehow). To get around this, you need a process to run automatically on a schedule and update the website. This is exactly what <a href="http://crontab.org/">cron jobs</a> are for.</p>
<p>Pelican also makes it fairly easy to push content with a single command (check out the make script). For my site, I use <code>make github</code> which grabs all the latest data, rebuilds the site, and pushes it to Github Pages. A similar process should work for the other <code>make</code> commands.</p>
<p>In my case, here is what I did:</p>
<ol>
<li>Set up a <a href="https://www.digitalocean.com/?refcode=94657bdeab0c">Digital Ocean server</a>.</li>
<li>Clone my pelican repository.</li>
<li>Set up the <code>make github</code> command and make sure it all works manually.</li>
<li>Create a cron job to run daily (at midnight, if you must really know).</li>
<li>Profit!!?!!</li>
</ol>
<p>The hardest part is step 3 and really depends on your server. I used a Python virtual environment but that didn't play very well with the PIL library. Safe to say, it was a pain and I recommend you not do what I did. In the case I go through this again, which is likely, I'll do a better job of documenting my steps the next time (sorry!).</p>
<h2>Boom - Static Dynamic Site!</h2>
<p>So there you have it! A static dynamic site with Python! </p>
<p>Let me know what you think on <a href="https://twitter.com/joeahand">Twitter</a>. If you want to see all the code it is on <a href="https://github.com/joehand/joeahand">GitHub</a>.</p>
    </article>

    <footer class="post-footer">
        <a class="small-caps" rel="bookmark" title="Permalink to Building a Dynamic yet Static Website with Pelican & IFTTT" href="https://joeahand.com/archive/dynamic-site-pelican-ifttt/">
            <span class="useicons">&#xe602;</span>
            <span class="pub_date">
                <abbr class="published" title="2015-08-08T00:00:00-06:00">
                  August 2015
                </abbr>
            </span>
        </a>
    </footer>
</section>

                </div> <!-- .page-content  -->
                <div class="pure-u-2-24 pure-u-lg-1-5"></div>
            </main> <!-- main  -->
            <footer role="contentinfo" class="site-footer l-box pure-g is-center">
                <div class="pure-u-2-5 pure-u-md-1-3">
                    <span class="copyright">
                        Joe Hand &nbsp;·&nbsp;
                            <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">© 2015</a>
                    </span>
                </div>
                <div class="pure-u-1-5 pure-u-md-1-3"><div class="ss-icons">
    <a class="mail ss-icon ss-circle" href="mailto:&#106;&#111;&#101;&#064;&#106;&#111;&#101;&#097;&#104;&#097;&#110;&#100;&#046;&#099;&#111;&#109;" rel="me">Email</a>
    <a class="twitter ss-icon ss-circle" href="http://twitter.com/joeahand/" rel="me">Twitter</a>
    <a class="instagram ss-icon ss-circle" href="http://instagram.com/joeahand" rel="me">Instagram</a>
    <a class="github ss-icon ss-circle" href="https://github.com/joehand" rel="me">GitHubOctocat</a>
</div></div>
                <div class="pure-u-2-5 pure-u-md-1-3">
                    <!-- <span>
                    <a href="https://joeahand.com/archive/">Archive</a>
                    </span>
                    &nbsp;·&nbsp;-->
                    <span>
                        <a href="https://joeahand.com/about/#about-site">Made By <span class="useicons">&#xe603;</span></a>
                    </span>
                </div>
            </footer>        </div> <!-- document -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/chartist/0.9.1/chartist.min.js"></script>
    <script data-no-instant src="//cdnjs.cloudflare.com/ajax/libs/instantclick/3.0.1/instantclick.min.js"></script><script type="text/javascript" data-no-instant data-cfasync="false">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37465100-3', 'auto');

    InstantClick.on('change', function() {
        ga('send', 'pageview', location.pathname + location.search);
    });
    InstantClick.init();
</script>
    </body>
</html>